<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>krusty Theme & Font Demo</title>
  <style>
    :root {
      --color-background: #1e1e1e;
      --color-foreground: #f0f0f0;
      --color-cursor: #f0f0f0;
      --color-selection: rgba(255, 255, 255, 0.2);
      --color-black: #1e1e1e;
      --color-red: #ff5f5f;
      --color-green: #5fff87;
      --color-yellow: #ffd75f;
      --color-blue: #5fafff;
      --color-magenta: #d75fff;
      --color-cyan: #5fffff;
      --color-white: #f0f0f0;
      --color-brightBlack: #6c6c6c;
      --color-brightRed: #ff8787;
      --color-brightGreen: #87ffaf;
      --color-brightYellow: #ffdf87;
      --color-brightBlue: #87c7ff;
      --color-brightMagenta: #df87ff;
      --color-brightCyan: #87ffff;
      --color-brightWhite: #ffffff;

      --symbol-prompt: '❯';
      --symbol-continuation: '…';
      --symbol-git-branch: '';
      --symbol-git-ahead: '⇡';
      --symbol-git-behind: '⇣';
      --symbol-git-staged: '●';
      --symbol-git-unstaged: '○';
      --symbol-git-untracked: '?';

      /* Font settings */
      --font-family: 'JetBrains Mono', 'Fira Code', 'Hack', 'Cascadia Code', 'Source Code Pro', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      --font-size: 14px;
      --font-weight: 400;
      --line-height: 1.4;
      --font-ligatures: normal;
    }

    /* System font stack for better performance */
    @font-face {
      font-family: 'SystemMono';
      src: local('SFMono-Regular'),
           local('Menlo'),
           local('Monaco'),
           local('Consolas'),
           local('Liberation Mono'),
           local('Courier New'),
           monospace;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      font-size: var(--font-size);
      font-weight: var(--font-weight);
      line-height: var(--line-height);
      font-variant-ligatures: var(--font-ligatures);
      background-color: var(--color-background);
      color: var(--color-foreground);
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
    }

    .controls {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .control-group label {
      font-size: 0.9em;
      opacity: 0.8;
    }

    select, input[type="range"], input[type="checkbox"] {
      padding: 5px 8px;
      border-radius: 4px;
      border: 1px solid var(--color-brightBlack);
      background: var(--color-black);
      color: var(--color-foreground);
    }

    input[type="range"] {
      width: 150px;
    }

    .theme-selector {
      margin-bottom: 2rem;
      padding: 1rem;
      background-color: var(--surface);
      border-radius: 0.5rem;
    }

    select, button {
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      background-color: var(--surface);
      color: var(--primary-text);
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      cursor: pointer;
    }

    .preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .theme-card {
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      overflow: hidden;
      transition: transform 0.2s;
    }

    .theme-card:hover {
      transform: translateY(-4px);
    }

    .theme-header {
      padding: 1rem;
      font-weight: bold;
      border-bottom: 1px solid var(--border);
    }

    .theme-colors {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
      padding: 1rem;
    }

    .color-swatch {
      height: 40px;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 2px rgba(0, 0, 0, 0.7);
    }

    .syntax-preview {
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      border-top: 1px solid var(--border);
    }

    .keyword { color: var(--syntax-keyword); }
    .string { color: var(--syntax-string); }
    .number { color: var(--syntax-number); }
    .comment { color: var(--syntax-comment); }
    .variable { color: var(--syntax-variable); }
    .function { color: var(--syntax-function); }
    .operator { color: var(--syntax-operator); }
  </style>
</head>
<body>
  <div class="container">
    <h1>krusty Theme & Font Demo</h1>

    <div class="controls">
      <div class="control-group">
        <label for="theme-select">Theme</label>
        <select id="theme-select">
          <!-- Will be populated by JavaScript -->
        </select>
      </div>

      <div class="control-group">
        <label for="font-family">Font</label>
        <select id="font-family">
          <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
          <option value="'Fira Code', monospace">Fira Code</option>
          <option value="'Hack', monospace">Hack</option>
          <option value="'Cascadia Code', monospace">Cascadia Code</option>
          <option value="'Source Code Pro', monospace">Source Code Pro</option>
          <option value="'Roboto Mono', monospace">Roboto Mono</option>
          <option value="'Ubuntu Mono', monospace">Ubuntu Mono</option>
          <option value="'Courier New', monospace">Courier New</option>
          <option value="'Monaco', monospace">Monaco</option>
          <option value="'Consolas', monospace">Consolas</option>
          <option value="'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', monospace">System Default</option>
        </select>
      </div>

      <div class="control-group">
        <label for="font-size">Size: <span id="font-size-value">14</span>px</label>
        <input type="range" id="font-size" min="10" max="24" value="14" step="1">
      </div>

      <div class="control-group">
        <label for="font-weight">Weight: <span id="font-weight-value">400</span></label>
        <input type="range" id="font-weight" min="100" max="900" value="400" step="100">
      </div>

      <div class="control-group">
        <label for="line-height">Line Height: <span id="line-height-value">1.4</span></label>
        <input type="range" id="line-height" min="1" max="3" value="1.4" step="0.1">
      </div>

      <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px;">
        <input type="checkbox" id="font-ligatures" checked>
        <label for="font-ligatures" style="margin: 0;">Ligatures</label>
      </div>

      <button id="toggle-dark-mode" style="margin-left: auto;">Toggle Dark/Light</button>
    </div>

    <div class="preview" id="theme-preview">
      <!-- Theme previews will be generated by JavaScript -->
    </div>

    <script type="module">
      // Load the krusty theme module
      import { getThemes, applyTheme, initThemes } from '../dist/theme.js'
      import { loadGoogleFont } from '../dist/utils/font-utils.js'

      // Initialize themes
      const themes = getThemes()
      const themeSelect = document.getElementById('theme-select')
      const fontFamilySelect = document.getElementById('font-family')
      const fontSizeInput = document.getElementById('font-size')
      const fontSizeValue = document.getElementById('font-size-value')
      const fontWeightInput = document.getElementById('font-weight')
      const fontWeightValue = document.getElementById('font-weight-value')
      const lineHeightInput = document.getElementById('line-height')
      const lineHeightValue = document.getElementById('line-height-value')
      const fontLigaturesInput = document.getElementById('font-ligatures')

      // Populate theme selector
      themes.forEach(theme => {
        const option = document.createElement('option')
        option.value = theme.name
        option.textContent = theme.name
        if (theme.name === 'terminal') {
          option.selected = true
        }
        themeSelect.appendChild(option)
      })

      // Apply font settings
      function applyFontSettings() {
        const root = document.documentElement
        const fontFamily = fontFamilySelect.value
        const fontSize = `${fontSizeInput.value}px`
        const fontWeight = fontWeightInput.value
        const lineHeight = lineHeightInput.value
        const ligatures = fontLigaturesInput.checked ? '"liga" 1, "calt" 1' : 'normal'

        // Update display values
        fontSizeValue.textContent = fontSizeInput.value
        fontWeightValue.textContent = fontWeight
        lineHeightValue.textContent = lineHeight

        // Apply to document
        root.style.setProperty('--font-family', fontFamily)
        root.style.setProperty('--font-size', fontSize)
        root.style.setProperty('--font-weight', fontWeight)
        root.style.setProperty('--line-height', lineHeight)
        root.style.setProperty('--font-ligatures', ligatures)

        // Try to load the selected Google Font
        const fontName = fontFamily.split(',')[0].replace(/'/g, '').trim()
        if (fontName && !['monospace', 'sans-serif', 'serif'].includes(fontName)) {
          loadGoogleFont(fontName, {
            weights: [100, 200, 300, 400, 500, 600, 700, 800, 900],
            display: 'swap'
          }).catch(err => {
            console.warn(`Failed to load font ${fontName}:`, err)
          })
        }
      }

      // Apply selected theme
      async function applySelectedTheme() {
        const themeName = themeSelect.value
        const theme = themes.find(t => t.name === themeName)
        if (theme) {
          await applyTheme(theme)

          // Apply font settings from theme if available
          if (theme.font) {
            if (theme.font.family) {
              fontFamilySelect.value = theme.font.family
            }
            if (theme.font.size) {
              fontSizeInput.value = theme.font.size.toString()
            }
            if (theme.font.weight) {
              fontWeightInput.value = typeof theme.font.weight === 'string' ?
                theme.font.weight.replace(/[^0-9]/g, '') || '400' :
                theme.font.weight.toString()
            }
            if (theme.font.lineHeight) {
              lineHeightInput.value = theme.font.lineHeight.toString()
            }
            if (theme.font.ligatures !== undefined) {
              fontLigaturesInput.checked = theme.font.ligatures
            }

            applyFontSettings()
          }
        }
      }

      // Event listeners
      themeSelect.addEventListener('change', applySelectedTheme)
      fontFamilySelect.addEventListener('change', applyFontSettings)
      fontSizeInput.addEventListener('input', applyFontSettings)
      fontWeightInput.addEventListener('input', applyFontSettings)
      lineHeightInput.addEventListener('input', applyFontSettings)
      fontLigaturesInput.addEventListener('change', applyFontSettings)

      // Toggle dark/light mode
      document.getElementById('toggle-dark-mode').addEventListener('click', () => {
        document.documentElement.classList.toggle('light-theme')
        document.documentElement.classList.toggle('dark-theme')

        // Update theme colors based on dark/light mode
        const isDark = document.documentElement.classList.contains('dark-theme')
        document.documentElement.style.setProperty('--color-background', isDark ? '#1e1e1e' : '#ffffff')
        document.documentElement.style.setProperty('--color-foreground', isDark ? '#f0f0f0' : '#333333')
      })

      // Set initial theme and font
      applySelectedTheme()
      applyFontSettings()

      // Initialize with dark theme by default
      document.documentElement.classList.add('dark-theme')
    </script>
  </div>

      themeManager.getAvailableThemes().forEach(theme => {
        if (theme.name.startsWith('auto')) return; // Skip auto themes in preview

        const card = document.createElement('div');
        card.className = 'theme-card';
        card.style.borderColor = theme.colors.border;
        card.style.backgroundColor = theme.colors.background;

        const header = document.createElement('div');
        header.className = 'theme-header';
        header.style.color = theme.colors.primaryText;
        header.style.borderBottomColor = theme.colors.border;
        header.textContent = theme.name;

        const colors = document.createElement('div');
        colors.className = 'theme-colors';

        // Add color swatches
        ['primaryText', 'background', 'surface', 'border', 'success', 'warning', 'error', 'info']
          .forEach(colorKey => {
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.style.backgroundColor = theme.colors[colorKey];
            swatch.textContent = colorKey;
            colors.appendChild(swatch);
          });

        // Add syntax preview
        const syntax = document.createElement('div');
        syntax.className = 'syntax-preview';
        syntax.style.color = theme.colors.primaryText;
        syntax.style.borderTopColor = theme.colors.border;
        syntax.innerHTML = `
          <div><span class="keyword">function</span> <span class="function">greet</span>() {</div>
          <div>  <span class="keyword">const</span> <span class="variable">name</span> = <span class="string">'krusty'</span>;</div>
          <div>  <span class="keyword">const</span> <span class="variable">version</span> = <span class="number">1.0</span>;</div>
          <div>  <span class="keyword">return</span> <span class="string">`Hello, </span>${name}<span class="string">!`</span> <span class="comment">// v${version}</span></div>
          <div>}</div>
        `;

        // Set CSS variables for syntax highlighting
        Object.entries(theme.colors.syntax || {}).forEach(([key, value]) => {
          syntax.style.setProperty(`--syntax-${key}`, value);
        });

        card.appendChild(header);
        card.appendChild(colors);
        card.appendChild(syntax);
        previewContainer.appendChild(card);
      });
    }

    // Initial render
    updatePreviews();
  </script>
</body>
</html>
